# 项目结构记录

## 记录规则
- 架构调整/目录变更/关键文件移动后更新
- 记录变更原因与影响范围, 便于快速追溯

## 结构条目

### 2026-01-18 - 项目初始化结构设计
- 变更原因: 基于opencode-obsidian-main参考实现,建立新项目Opencode2Obsidian
- 影响模块: 全项目
- 结构要点:
  ```
  Opencode2Obsidian/
  ├── Documents/                    # 项目文档(SOP标准结构)
  │   ├── Track/                    # 版本跟踪
  │   │   └── 版本更新.md
  │   ├── Structure/                # 结构记录
  │   │   └── 结构记录.md
  │   └── Function/                 # 功能文档
  │       ├── 功能索引.md
  │       ├── 01-插件初始化/
  │       ├── 02-OpenCode服务管理/
  │       ├── 03-Obsidian视图集成/
  │       ├── 04-跨平台支持/
  │       ├── 05-Skills集成/
  │       └── 06-AGENTS初始化/
  ├── src/                          # 源代码(参考opencode-obsidian-main)
  │   ├── main.ts                   # 插件入口
  │   ├── types.ts                  # 类型定义和常量
  │   ├── OpenCodeView.ts           # Obsidian侧边栏视图
  │   ├── ProcessManager.ts         # OpenCode服务进程管理
  │   ├── SettingsTab.ts            # 设置页面
  │   └── icons.ts                  # 自定义图标
  ├── tests/                        # 测试文件
  ├── assets/                       # 资源文件(图片等)
  ├── openspec/                     # OpenSpec规范(可选)
  ├── package.json                  # 项目配置
  ├── tsconfig.json                 # TypeScript配置
  ├── esbuild.config.mjs            # 构建配置
  ├── manifest.json                 # Obsidian插件清单
  ├── styles.css                    # 样式文件
  └── README.md                     # 项目说明
  ```
- 核心技术栈:
  - TypeScript (严格模式)
  - Obsidian Plugin API
  - Node.js child_process (进程管理)
  - esbuild (构建工具)
  - Bun (包管理器)
- 架构模式:
  - **插件模式**: 继承Obsidian Plugin基类
  - **视图模式**: 继承ItemView实现自定义视图
  - **进程管理**: ProcessManager管理OpenCode服务生命周期
  - **状态订阅**: 回调模式实现状态变更通知
  - **设置管理**: PluginSettingTab提供配置界面
- 相关提交/PR: 初始提交(待创建)

### 参考实现关键设计点
1. **Desktop Only**: 依赖Node.js child_process,不支持移动端
2. **iframe集成**: 通过iframe嵌入OpenCode Web UI
3. **懒加载**: 打开视图时才启动服务器(可选自动启动)
4. **健康检查**: 通过/global/health端点检测服务状态
5. **项目路径编码**: 使用base64编码vault路径传递给OpenCode
6. **CORS配置**: 允许app://obsidian.md域名访问
