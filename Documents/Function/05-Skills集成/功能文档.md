# 05-Skills集成

## 背景/目标

提供一组预置的OpenCode Skills,帮助用户在Obsidian vault中更好地使用AI助手功能。

**参考roadmap**: v0.2.0目标 - "3-4 sample skills useful in a vault"

**目标**:
- 提供3-4个适用于笔记管理的skills
- 支持从插件设置启用/禁用skills
- 提供skill模板和文档
- 与vault内容无缝集成

## 方案/计划

### Skills候选列表
1. **note-summarizer**: 总结和提炼笔记内容
2. **markdown-formatter**: Markdown格式化和优化
3. **knowledge-linker**: 自动发现笔记间的关联
4. **daily-note-helper**: 每日笔记模板和助手

### 实现步骤
1. [ ] 设计skills存储结构
   - 插件内置skills目录
   - 用户自定义skills路径

2. [ ] 创建示例skills
   - 编写skill定义文件
   - 测试skill功能

3. [ ] 实现skills管理UI
   - 设置页面中的skills列表
   - 启用/禁用开关
   - skill描述展示

4. [ ] 配置OpenCode环境
   - 传递skills路径给OpenCode
   - 环境变量配置

## 实现要点

### Skills目录结构
```
plugin/
├── skills/                    # 内置skills
│   ├── note-summarizer/
│   │   ├── skill.md
│   │   └── examples/
│   ├── markdown-formatter/
│   │   └── skill.md
│   ├── knowledge-linker/
│   │   └── skill.md
│   └── daily-note-helper/
│       └── skill.md
└── src/
```

### Skill配置管理
```typescript
interface SkillConfig {
  id: string;
  name: string;
  description: string;
  enabled: boolean;
  builtin: boolean;
  path: string;
}

interface OpenCodeSettings {
  // ... 其他设置
  enabledSkills: string[];      // 启用的skill ID列表
  customSkillsPath: string;     // 用户自定义skills路径
}
```

### Skills UI
```typescript
// 在SettingsTab中添加skills管理
new Setting(containerEl)
  .setName("OpenCode Skills")
  .setDesc("Enable AI skills for your vault")
  .setHeading();

// 列出所有skills
for (const skill of this.getAvailableSkills()) {
  new Setting(containerEl)
    .setName(skill.name)
    .setDesc(skill.description)
    .addToggle(toggle => toggle
      .setValue(skill.enabled)
      .onChange(async (value) => {
        await this.plugin.toggleSkill(skill.id, value);
      }));
}
```

### 传递skills给OpenCode
```typescript
// 修改spawn参数
const skillsArgs = this.getEnabledSkillsArgs();

this.process = spawn(
  this.settings.opencodePath,
  [
    "serve",
    "--port", this.settings.port.toString(),
    "--hostname", this.settings.hostname,
    "--cors", "app://obsidian.md",
    ...skillsArgs  // 添加skills参数
  ],
  spawnOptions
);

// 获取skills参数
getEnabledSkillsArgs(): string[] {
  const args: string[] = [];
  const enabledSkills = this.getEnabledSkills();
  
  for (const skill of enabledSkills) {
    args.push("--skill", skill.path);
  }
  
  return args;
}
```

## Skill示例

### note-summarizer
```markdown
## Skill: note-summarizer

**用于Obsidian笔记的智能总结工具**

### 功能
- 总结长篇笔记为简洁摘要
- 提取关键要点
- 生成大纲结构

### 使用方式
选中笔记内容后,使用命令:
`/summarize note`

### 示例
输入: 一篇3000字的会议记录
输出: 
- 会议主题
- 关键决策(3-5条)
- 行动项
- 下次会议时间
```

### markdown-formatter
```markdown
## Skill: markdown-formatter

**Markdown格式优化工具**

### 功能
- 标准化标题层级
- 修复列表格式
- 优化表格排版
- 统一代码块格式

### 使用方式
`/format markdown`

### 配置
- 标题样式: ATX (#) 或 Setext (===)
- 列表缩进: 2空格或4空格
- 代码块: 围栏式或缩进式
```

### knowledge-linker
```markdown
## Skill: knowledge-linker

**自动发现笔记关联**

### 功能
- 扫描vault分析笔记主题
- 发现概念关联
- 建议添加链接
- 生成知识图谱

### 使用方式
`/suggest links`

### 输出
返回建议的[[wiki-links]],按相关性排序
```

## 问题与解决

### 问题1: Skills加载顺序
- **问题**: 多个skills可能有依赖关系
- **解决**: 
  - 简化设计,避免skill间依赖
  - 或实现简单的依赖声明机制

### 问题2: Skills与vault权限
- **问题**: Skills需要访问vault文件
- **解决**: 
  - OpenCode已有vault路径
  - Skills通过OpenCode API访问
  - 无需额外权限配置

### 问题3: Skills版本管理
- **问题**: Skills更新可能破坏兼容性
- **解决**: 
  - 内置skills跟随插件版本
  - 提供skill版本声明
  - 更新时提示用户

### 问题4: 自定义skills路径
- **问题**: 用户想添加自己的skills
- **解决**: 
  - 提供customSkillsPath设置
  - 同时加载内置和自定义skills
  - UI中区分显示

## 复盘

**待实施后填写**

## 后续

1. 研究OpenCode的skill系统
2. 设计3-4个实用skills
3. 实现skills管理UI
4. 编写skills文档和教程
5. 收集用户反馈优化skills

